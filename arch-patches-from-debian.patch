From 3890aee6ce02c6d9caff5fd6d492f8e98f10cc48 Mon Sep 17 00:00:00 2001
From: Liu Yang <yanliu@redhat.com>
Date: Sat, 4 Feb 2023 02:07:45 +0800
Subject: [PATCH 1/2] Revoke addtional patch.

---
 mingw-w64-tools/widl/include/basetsd.h |  4 +-
 mingw-w64-tools/widl/include/winnt.h   | 60 --------------------------
 mingw-w64-tools/widl/tools.h           | 14 +-----
 3 files changed, 3 insertions(+), 75 deletions(-)

diff --git a/mingw-w64-tools/widl/include/basetsd.h b/mingw-w64-tools/widl/include/basetsd.h
index 0963881..a4774a2 100644
--- a/mingw-w64-tools/widl/include/basetsd.h
+++ b/mingw-w64-tools/widl/include/basetsd.h
@@ -36,7 +36,7 @@ extern "C" {
  * 64-bit.
  */
 
-#if (defined(__x86_64__) || defined(__powerpc64__) || defined(__aarch64__) || defined(__s390x__)) && !defined(_WIN64)
+#if (defined(__x86_64__) || defined(__powerpc64__) || defined(__aarch64__)) && !defined(_WIN64)
 #define _WIN64
 #endif
 
@@ -295,8 +295,6 @@ typedef ULONG_PTR KAFFINITY, *PKAFFINITY;
 # define WORDS_BIGENDIAN
 #elif defined(__MIPSEL__)
 # undef  WORDS_BIGENDIAN
-#elif defined(__s390__)
-# define WORDS_BIGENDIAN
 #elif !defined(RC_INVOKED) && !defined(__WIDL__) && !defined(__midl)
 # error Unknown CPU architecture!
 #endif
diff --git a/mingw-w64-tools/widl/include/winnt.h b/mingw-w64-tools/widl/include/winnt.h
index 25407dc..9296a3d 100644
--- a/mingw-w64-tools/widl/include/winnt.h
+++ b/mingw-w64-tools/widl/include/winnt.h
@@ -1651,66 +1651,6 @@ typedef struct _KNONVOLATILE_CONTEXT_POINTERS
 
 #endif /* __aarch64__ */
 
-#ifdef __s390x__
-
-/*
- * FIXME:
- *
- * There is no official CONTEXT structure defined for the S/390
- * architecture, so I just made one up.
- *
- * This structure is completely dummy, made just to build widl.
- *
- */
-
-#define CONTEXT_S390X            0x10000000
-
-#define CONTEXT_CONTROL         (CONTEXT_S390X | 0x00000001)
-#define CONTEXT_FLOATING_POINT  (CONTEXT_S390X | 0x00000002)
-#define CONTEXT_INTEGER         (CONTEXT_S390X | 0x00000004)
-
-#define CONTEXT_FULL (CONTEXT_CONTROL | CONTEXT_FLOATING_POINT | CONTEXT_INTEGER)
-
-#define EXCEPTION_READ_FAULT    0
-#define EXCEPTION_WRITE_FAULT   1
-#define EXCEPTION_EXECUTE_FAULT 8
-
-typedef struct _CONTEXT
-{
-} CONTEXT, *PCONTEXT;
-
-#endif  /* __s390x__ */
-
-#ifdef __PPC64__
-
-/*
- * FIXME:
- *
- * There is no official CONTEXT structure defined for the PPC64
- * architecture, so I just made one up.
- *
- * This structure is completely dummy, made just to build widl.
- *
- */
-
-#define CONTEXT_PPC64            0x10000000
-
-#define CONTEXT_CONTROL         (CONTEXT_PPC64 | 0x00000001)
-#define CONTEXT_FLOATING_POINT  (CONTEXT_PPC64 | 0x00000002)
-#define CONTEXT_INTEGER         (CONTEXT_PPC64 | 0x00000004)
-
-#define CONTEXT_FULL (CONTEXT_CONTROL | CONTEXT_FLOATING_POINT | CONTEXT_INTEGER)
-
-#define EXCEPTION_READ_FAULT    0
-#define EXCEPTION_WRITE_FAULT   1
-#define EXCEPTION_EXECUTE_FAULT 8
-
-typedef struct _CONTEXT
-{
-} CONTEXT, *PCONTEXT;
-
-#endif  /* __PPC64__ */
-
 #if !defined(CONTEXT_FULL) && !defined(RC_INVOKED)
 #error You need to define a CONTEXT for your CPU
 #endif
diff --git a/mingw-w64-tools/widl/tools.h b/mingw-w64-tools/widl/tools.h
index 0d6f35c..1e86e38 100644
--- a/mingw-w64-tools/widl/tools.h
+++ b/mingw-w64-tools/widl/tools.h
@@ -79,7 +79,7 @@
 
 struct target
 {
-    enum { CPU_i386, CPU_x86_64, CPU_ARM, CPU_ARM64, CPU_S390X, CPU_PPC64 } cpu;
+    enum { CPU_i386, CPU_x86_64, CPU_ARM, CPU_ARM64 } cpu;
 
     enum
     {
@@ -383,10 +383,6 @@ static inline struct target get_default_target(void)
     target.cpu = CPU_ARM;
 #elif defined(__aarch64__)
     target.cpu = CPU_ARM64;
-#elif defined(__s390x__)
-    target.cpu = CPU_S390X;
-#elif defined(__PPC64__)
-    target.cpu = CPU_PPC64;
 #else
 #error Unsupported CPU
 #endif
@@ -421,8 +417,6 @@ static inline unsigned int get_target_ptr_size( struct target target )
         [CPU_x86_64]    = 8,
         [CPU_ARM]       = 4,
         [CPU_ARM64]     = 8,
-        [CPU_S390X]     = 8,
-        [CPU_PPC64]     = 8,
     };
     return sizes[target.cpu];
 }
@@ -466,8 +460,6 @@ static inline int get_cpu_from_name( const char *name )
         { "aarch64",   CPU_ARM64 },
         { "arm64",     CPU_ARM64 },
         { "arm",       CPU_ARM },
-        { "s390x",     CPU_S390X },
-        { "ppc64",     CPU_PPC64 }
     };
     unsigned int i;
 
@@ -513,9 +505,7 @@ static inline const char *get_arch_dir( struct target target )
         [CPU_i386]   = "i386",
         [CPU_x86_64] = "x86_64",
         [CPU_ARM]    = "arm",
-        [CPU_ARM64]  = "aarch64",
-        [CPU_S390X]  = "s390x",
-        [CPU_PPC64]  = "ppc64",
+        [CPU_ARM64]  = "aarch64"
     };
 
     if (!cpu_names[target.cpu]) return "";
-- 
2.39.1


From 182e22351e3f2819c27cf456b9233abda2dc2e55 Mon Sep 17 00:00:00 2001
From: Liu Yang <yanliu@redhat.com>
Date: Sat, 4 Feb 2023 02:09:52 +0800
Subject: [PATCH 2/2] Apply all arch patches from Debian.

---
 mingw-w64-crt/Makefile.am                |   2 +-
 mingw-w64-libraries/libmangle/src/m_ms.c |   2 +-
 mingw-w64-tools/gendef/Makefile.am       |   2 +-
 mingw-w64-tools/gendef/src/gendef.c      |   3 +-
 mingw-w64-tools/genpeimg/Makefile.am     |   2 +-
 mingw-w64-tools/genpeimg/src/genpeimg.c  |  40 +--
 mingw-w64-tools/genpeimg/src/img_pe.c    |   4 +-
 mingw-w64-tools/widl/include/basetsd.h   |  18 +-
 mingw-w64-tools/widl/include/winbase.h   |  17 -
 mingw-w64-tools/widl/include/winnt.h     | 376 -----------------------
 mingw-w64-tools/widl/src/pathtools.c     |   2 -
 mingw-w64-tools/widl/tools.h             |   4 +-
 12 files changed, 47 insertions(+), 425 deletions(-)

diff --git a/mingw-w64-crt/Makefile.am b/mingw-w64-crt/Makefile.am
index a4699e0..45cc786 100644
--- a/mingw-w64-crt/Makefile.am
+++ b/mingw-w64-crt/Makefile.am
@@ -36,7 +36,7 @@ if WITH_GENLIB
   DTDEF32=$(GENLIB) $(DLLTOOLFLAGS32) $(AM_DLLTOOLFLAGS)
   DTDEF64=$(GENLIB) $(DLLTOOLFLAGS64) $(AM_DLLTOOLFLAGS)
 else
-  AM_DLLTOOLFLAGS=-k --as=$(AS) --output-lib $@
+  AM_DLLTOOLFLAGS=-k --as=$(AS) --output-lib $@ --temp-prefix $$(basename $@ .a)
   DLLTOOLFLAGSARM32=-m arm
   DLLTOOLFLAGSARM64=-m arm64
   DLLTOOLFLAGS32=--as-flags=--32 -m i386
diff --git a/mingw-w64-libraries/libmangle/src/m_ms.c b/mingw-w64-libraries/libmangle/src/m_ms.c
index e733bb8..2e62acc 100644
--- a/mingw-w64-libraries/libmangle/src/m_ms.c
+++ b/mingw-w64-libraries/libmangle/src/m_ms.c
@@ -685,7 +685,7 @@ get_operator_name (sMSCtx *c, int fIsTemplate, int *pfReadTemplateArguments)
               return m_oper (c, m_rtti (c, "complete_object_locator"));
           }
         DEC_CHAR (c);
-        fprintf (stderr, " *** Unkown RTTI %c\n", ch);
+        fprintf (stderr, " *** Unknown RTTI %c\n", ch);
         c->err = 2;
         return NULL;
       case 'S':
diff --git a/mingw-w64-tools/gendef/Makefile.am b/mingw-w64-tools/gendef/Makefile.am
index 20bf6df..3239e23 100644
--- a/mingw-w64-tools/gendef/Makefile.am
+++ b/mingw-w64-tools/gendef/Makefile.am
@@ -4,7 +4,7 @@ AM_CPPFLAGS = @GENDEF_CPPFLAGS@
 
 gendef_SOURCES = src/gendef.h src/compat_string.h src/gendef.c src/gendef_def.c src/compat_string.c \
                  src/fsredir.c src/fsredir.h
-gendef_CFLAGS = $(AM_CFLAGS) -Werror -Wall -W
+gendef_CFLAGS = $(AM_CFLAGS) -Wall
 
 EXTRA_DIST = $(srcdir)/ChangeLog*
 DISTCHECK_CONFIGURE_FLAGS = --host=$(host) --with-mangle=@with_mangle@
diff --git a/mingw-w64-tools/gendef/src/gendef.c b/mingw-w64-tools/gendef/src/gendef.c
index 4aa9a42..978e322 100644
--- a/mingw-w64-tools/gendef/src/gendef.c
+++ b/mingw-w64-tools/gendef/src/gendef.c
@@ -115,7 +115,7 @@ opt_chain (const char *opts, const char *next)
     {
       if (!next)
         {
-	  fprintf (stderr, "Error: %s expects path as next arguement.", opts);
+	  fprintf (stderr, "Error: %s expects path as next argument.", opts);
 	  return 0;
         }
       gendef_addpath_def (next);
@@ -196,7 +196,6 @@ show_usage (void)
                    "  By default, the output files are named after their DLL counterparts\n"
                    "  gendef MYDLL.DLL     Produces MYDLL.def\n"
                    "  gendef - MYDLL.DLL   Prints the exports to stdout\n");
-  fprintf (stderr, "\nBuilt on %s\n", __DATE__);
   fprintf (stderr, "\nReport bugs to <mingw-w64-public@lists.sourceforge.net>\n");
   exit (0);
 }
diff --git a/mingw-w64-tools/genpeimg/Makefile.am b/mingw-w64-tools/genpeimg/Makefile.am
index c7a5d5d..3f5219b 100644
--- a/mingw-w64-tools/genpeimg/Makefile.am
+++ b/mingw-w64-tools/genpeimg/Makefile.am
@@ -1,6 +1,6 @@
 bin_PROGRAMS = genpeimg
 genpeimg_SOURCES = src/img.h src/img.c src/img_pe.c src/genpeimg.c
 genpeimg_CPPFLAGS = -Isrc
-genpeimg_CFLAGS = $(AM_CFLAGS) -O3 -g -Werror -Wall -Wextra
+genpeimg_CFLAGS = $(AM_CFLAGS) -O3 -g -Wall -Wextra
 
 DISTCHECK_CONFIGURE_FLAGS = --host=$(host)
diff --git a/mingw-w64-tools/genpeimg/src/genpeimg.c b/mingw-w64-tools/genpeimg/src/genpeimg.c
index af17129..566af60 100644
--- a/mingw-w64-tools/genpeimg/src/genpeimg.c
+++ b/mingw-w64-tools/genpeimg/src/genpeimg.c
@@ -49,7 +49,6 @@ unsigned short set_pe_opt_hdr_dll_chara = 0;
 unsigned short mask_pe_opt_hdr_dll_chara = 0xffff;
 unsigned short set_subsystem = 0xffff;
 int dump_information = 0;
-static char *file_name = NULL;
 
 static void __attribute__((noreturn))
 show_usage (void)
@@ -108,7 +107,6 @@ pass_args (int argc, char **argv)
       if (h[0] != '-')
         {
 	  has_file = 1;
-	  file_name = h;
 	  continue;
 	}
       switch (h[1])
@@ -301,26 +299,32 @@ error_point:
 
 int main (int argc, char **argv)
 {
+  char *file_name;
   pe_image *pe;
   --argc, ++argv;
   pass_args (argc, argv);
 
-  pe = peimg_load (file_name);
-  if (!pe)
-    {
-      fprintf (stderr, "File not found, or no PE-image\n");
-      return 0;
-    }
+  while (argc-- > 0) {
+    file_name = *argv++;
+    if (file_name[0] != '-' && file_name[0] != '+') {
+      pe = peimg_load (file_name);
+      if (!pe)
+	{
+	  fprintf (stderr, "File %s not found, or no PE-image\n", file_name);
+	  return 0;
+	}
 
-  if (dump_information)
-    peimg_show (pe, stdout);
-  /* First we need to do actions which aren't modifying image's size.  */
-  peimg_set_hdr_characeristics (pe, set_pe_hdr_chara, mask_pe_hdr_chara);
-  peimg_set_hdr_opt_dll_characteristics (pe, set_pe_opt_hdr_dll_chara, mask_pe_opt_hdr_dll_chara);
-  if (set_subsystem != 0xffff)
-    peimg_set_hdr_opt_subsystem (pe, set_subsystem);
-  if (pe->pimg->is_modified)
-    pe->pimg->want_save = 1;
-  peimg_free (pe);
+      if (dump_information)
+	peimg_show (pe, stdout);
+      /* First we need to do actions which aren't modifying image's size.  */
+      peimg_set_hdr_characeristics (pe, set_pe_hdr_chara, mask_pe_hdr_chara);
+      peimg_set_hdr_opt_dll_characteristics (pe, set_pe_opt_hdr_dll_chara, mask_pe_opt_hdr_dll_chara);
+      if (set_subsystem != 0xffff)
+	peimg_set_hdr_opt_subsystem (pe, set_subsystem);
+      if (pe->pimg->is_modified)
+	pe->pimg->want_save = 1;
+      peimg_free (pe);
+    }
+  }
   return 0;
 }
diff --git a/mingw-w64-tools/genpeimg/src/img_pe.c b/mingw-w64-tools/genpeimg/src/img_pe.c
index 91aef95..26280cf 100644
--- a/mingw-w64-tools/genpeimg/src/img_pe.c
+++ b/mingw-w64-tools/genpeimg/src/img_pe.c
@@ -227,7 +227,7 @@ peimg_show (pe_image *ppeimg, FILE *outfp)
       fprintf (outfp, "\n");
     }
   fprintf (outfp, "PE+ optional header information\n"
-    "  Linker version %u.%u, Code size: 0x%x, Intialized Data size: 0x%x\n"
+    "  Linker version %u.%u, Code size: 0x%x, Initialized Data size: 0x%x\n"
     "  Uninitialized Data size: 0x%x, Entry-point 0x%x\n",
       PEIMG_GET_UCHAR (ppeimg, ppeimg->optional_hdr_pos + 2),
       PEIMG_GET_UCHAR (ppeimg, ppeimg->optional_hdr_pos + 3),
@@ -284,7 +284,7 @@ peimg_show (pe_image *ppeimg, FILE *outfp)
     case 14: fprintf (outfp, "XBOX (14)\n"); break;
     case 16: fprintf (outfp, "Windows Boot Application (16)\n"); break;
     default:
-      fprintf (outfp, "Unkown (%u)\n", PEIMG_GET_USHORT (ppeimg, ppeimg->optional_hdr_pos + 68));
+      fprintf (outfp, "Unknown (%u)\n", PEIMG_GET_USHORT (ppeimg, ppeimg->optional_hdr_pos + 68));
       break;
     }
   hdr_cha = PEIMG_GET_USHORT (ppeimg, ppeimg->optional_hdr_pos + 70);
diff --git a/mingw-w64-tools/widl/include/basetsd.h b/mingw-w64-tools/widl/include/basetsd.h
index a4774a2..1ff0dc5 100644
--- a/mingw-w64-tools/widl/include/basetsd.h
+++ b/mingw-w64-tools/widl/include/basetsd.h
@@ -36,7 +36,7 @@ extern "C" {
  * 64-bit.
  */
 
-#if (defined(__x86_64__) || defined(__powerpc64__) || defined(__aarch64__)) && !defined(_WIN64)
+#if (defined(__x86_64__) || defined(__powerpc64__) || defined(__aarch64__) || defined(__sparc64__) || defined(__ia64__) || defined(__s390x__)) && !defined(_WIN64)
 #define _WIN64
 #endif
 
@@ -281,7 +281,7 @@ typedef ULONG_PTR KAFFINITY, *PKAFFINITY;
 # undef  WORDS_BIGENDIAN
 #elif defined(__powerpc__)
 # define WORDS_BIGENDIAN
-#elif defined(__ALPHA__)
+#elif defined(__alpha__)
 # undef  WORDS_BIGENDIAN
 #elif defined(__ARMEB__)
 # define WORDS_BIGENDIAN
@@ -295,6 +295,20 @@ typedef ULONG_PTR KAFFINITY, *PKAFFINITY;
 # define WORDS_BIGENDIAN
 #elif defined(__MIPSEL__)
 # undef  WORDS_BIGENDIAN
+#elif defined(__ia64__)
+# undef  WORDS_BIGENDIAN
+#elif defined(__s390__) || defined(__s390x__)
+# define WORDS_BIGENDIAN
+#elif defined(__hppa__)
+# undef  WORDS_BIGENDIAN
+#elif defined(__m68k__)
+# define WORDS_BIGENDIAN
+#elif defined(__riscv) && __riscv_xlen == 64
+# undef  WORDS_BIGENDIAN
+#elif defined(__sh__)
+# undef  WORDS_BIGENDIAN
+#elif defined(__sparc__) && defined(__arch64__)
+# define WORDS_BIGENDIAN
 #elif !defined(RC_INVOKED) && !defined(__WIDL__) && !defined(__midl)
 # error Unknown CPU architecture!
 #endif
diff --git a/mingw-w64-tools/widl/include/winbase.h b/mingw-w64-tools/widl/include/winbase.h
index 0a0bfde..ea43398 100644
--- a/mingw-w64-tools/widl/include/winbase.h
+++ b/mingw-w64-tools/widl/include/winbase.h
@@ -159,13 +159,6 @@ typedef struct _DEBUG_EVENT {
     } u;
 } DEBUG_EVENT, *LPDEBUG_EVENT;
 
-typedef PCONTEXT LPCONTEXT;
-typedef PEXCEPTION_RECORD LPEXCEPTION_RECORD;
-typedef PEXCEPTION_POINTERS LPEXCEPTION_POINTERS;
-
-typedef LONG (CALLBACK *PTOP_LEVEL_EXCEPTION_FILTER)(PEXCEPTION_POINTERS);
-typedef PTOP_LEVEL_EXCEPTION_FILTER LPTOP_LEVEL_EXCEPTION_FILTER;
-
 #define OFS_MAXPATHNAME 128
 typedef struct _OFSTRUCT
 {
@@ -1773,7 +1766,6 @@ WINADVAPI  BOOL        WINAPI AddAuditAccessAce(PACL,DWORD,DWORD,PSID,BOOL,BOOL)
 WINADVAPI  BOOL        WINAPI AddAuditAccessAceEx(PACL,DWORD,DWORD,DWORD,PSID,BOOL,BOOL);
 WINADVAPI  BOOL        WINAPI AddMandatoryAce(PACL,DWORD,DWORD,DWORD,PSID);
 WINBASEAPI VOID        WINAPI AddRefActCtx(HANDLE);
-WINBASEAPI PVOID       WINAPI AddVectoredExceptionHandler(ULONG,PVECTORED_EXCEPTION_HANDLER);
 WINADVAPI  BOOL        WINAPI AdjustTokenGroups(HANDLE,BOOL,PTOKEN_GROUPS,DWORD,PTOKEN_GROUPS,PDWORD);
 WINADVAPI  BOOL        WINAPI AccessCheck(PSECURITY_DESCRIPTOR,HANDLE,DWORD,PGENERIC_MAPPING,PPRIVILEGE_SET,LPDWORD,LPDWORD,LPBOOL);
 WINADVAPI  BOOL        WINAPI AccessCheckAndAuditAlarmA(LPCSTR,LPVOID,LPSTR,LPSTR,PSECURITY_DESCRIPTOR,DWORD,PGENERIC_MAPPING,BOOL,LPDWORD,LPBOOL,LPBOOL);
@@ -1833,7 +1825,6 @@ WINBASEAPI BOOL        WINAPI CommConfigDialogW(LPCWSTR,HWND,LPCOMMCONFIG);
 WINBASEAPI BOOL        WINAPI ConnectNamedPipe(HANDLE,LPOVERLAPPED);
 WINBASEAPI BOOL        WINAPI ContinueDebugEvent(DWORD,DWORD,DWORD);
 WINBASEAPI HANDLE      WINAPI ConvertToGlobalHandle(HANDLE hSrc);
-WINBASEAPI BOOL        WINAPI CopyContext(CONTEXT*, DWORD, CONTEXT*);
 WINBASEAPI BOOL        WINAPI CopyFileA(LPCSTR,LPCSTR,BOOL);
 WINBASEAPI BOOL        WINAPI CopyFileW(LPCWSTR,LPCWSTR,BOOL);
 #define                       CopyFile WINELIB_NAME_AW(CopyFile)
@@ -2308,7 +2299,6 @@ WINBASEAPI UINT        WINAPI GetTempFileNameW(LPCWSTR,LPCWSTR,UINT,LPWSTR);
 WINBASEAPI DWORD       WINAPI GetTempPathA(DWORD,LPSTR);
 WINBASEAPI DWORD       WINAPI GetTempPathW(DWORD,LPWSTR);
 #define                       GetTempPath WINELIB_NAME_AW(GetTempPath)
-WINBASEAPI BOOL        WINAPI GetThreadContext(HANDLE,CONTEXT *);
 WINBASEAPI DWORD       WINAPI GetThreadErrorMode(void);
 WINBASEAPI DWORD       WINAPI GetThreadId(HANDLE);
 WINBASEAPI BOOL        WINAPI GetThreadIOPendingFlag(HANDLE,PBOOL);
@@ -2345,7 +2335,6 @@ WINBASEAPI UINT        WINAPI GetWindowsDirectoryA(LPSTR,UINT);
 WINBASEAPI UINT        WINAPI GetWindowsDirectoryW(LPWSTR,UINT);
 #define                       GetWindowsDirectory WINELIB_NAME_AW(GetWindowsDirectory)
 WINBASEAPI UINT        WINAPI GetWriteWatch(DWORD,LPVOID,SIZE_T,LPVOID*,ULONG_PTR*,ULONG*);
-WINBASEAPI BOOL        WINAPI GetXStateFeaturesMask(CONTEXT*,DWORD64*);
 WINBASEAPI ATOM        WINAPI GlobalAddAtomA(LPCSTR);
 WINBASEAPI ATOM        WINAPI GlobalAddAtomW(LPCWSTR);
 #define                       GlobalAddAtom WINELIB_NAME_AW(GlobalAddAtom)
@@ -2388,8 +2377,6 @@ WINBASEAPI BOOL        WINAPI HeapWalk(HANDLE,LPPROCESS_HEAP_ENTRY);
 WINBASEAPI BOOL        WINAPI InitAtomTable(DWORD);
 WINADVAPI  BOOL        WINAPI InitializeAcl(PACL,DWORD,DWORD);
 WINBASEAPI VOID        WINAPI InitializeConditionVariable(PCONDITION_VARIABLE);
-WINBASEAPI BOOL        WINAPI InitializeContext(void *,DWORD,CONTEXT **,DWORD *);
-WINBASEAPI BOOL        WINAPI InitializeContext2(void *,DWORD,CONTEXT **,DWORD *,ULONG64);
 WINBASEAPI void        WINAPI InitializeCriticalSection(CRITICAL_SECTION *lpCrit);
 WINBASEAPI BOOL        WINAPI InitializeCriticalSectionAndSpinCount(CRITICAL_SECTION *,DWORD);
 WINBASEAPI BOOL        WINAPI InitializeCriticalSectionEx(CRITICAL_SECTION *,DWORD,DWORD);
@@ -2448,7 +2435,6 @@ WINBASEAPI HLOCAL      WINAPI LocalReAlloc(HLOCAL,SIZE_T,UINT) __WINE_ALLOC_SIZE
 WINBASEAPI SIZE_T      WINAPI LocalShrink(HGLOBAL,UINT);
 WINBASEAPI SIZE_T      WINAPI LocalSize(HLOCAL);
 WINBASEAPI BOOL        WINAPI LocalUnlock(HLOCAL);
-WINBASEAPI void *      WINAPI LocateXStateFeature(CONTEXT *,DWORD,DWORD *);
 WINBASEAPI LPVOID      WINAPI LockResource(HGLOBAL);
 #define                       LockSegment(handle) GlobalFix((HANDLE)(handle))
 WINADVAPI  BOOL        WINAPI LookupAccountNameA(LPCSTR,LPCSTR,PSID,LPDWORD,LPSTR,LPDWORD,PSID_NAME_USE);
@@ -2689,7 +2675,6 @@ WINBASEAPI BOOL        WINAPI SetSystemTimeAdjustment(DWORD,BOOL);
 WINBASEAPI DWORD       WINAPI SetTapeParameters(HANDLE,DWORD,LPVOID);
 WINBASEAPI DWORD       WINAPI SetTapePosition(HANDLE,DWORD,DWORD,DWORD,DWORD,BOOL);
 WINBASEAPI DWORD_PTR   WINAPI SetThreadAffinityMask(HANDLE,DWORD_PTR);
-WINBASEAPI BOOL        WINAPI SetThreadContext(HANDLE,const CONTEXT *);
 WINBASEAPI BOOL        WINAPI SetThreadErrorMode(DWORD,LPDWORD);
 WINBASEAPI DWORD       WINAPI SetThreadExecutionState(EXECUTION_STATE);
 WINBASEAPI DWORD       WINAPI SetThreadIdealProcessor(HANDLE,DWORD);
@@ -2698,7 +2683,6 @@ WINBASEAPI BOOL        WINAPI SetThreadPriorityBoost(HANDLE,BOOL);
 WINADVAPI  BOOL        WINAPI SetThreadToken(PHANDLE,HANDLE);
 WINBASEAPI HANDLE      WINAPI SetTimerQueueTimer(HANDLE,WAITORTIMERCALLBACK,PVOID,DWORD,DWORD,BOOL);
 WINADVAPI  BOOL        WINAPI SetTokenInformation(HANDLE,TOKEN_INFORMATION_CLASS,LPVOID,DWORD);
-WINBASEAPI LPTOP_LEVEL_EXCEPTION_FILTER WINAPI SetUnhandledExceptionFilter(LPTOP_LEVEL_EXCEPTION_FILTER);
 WINBASEAPI BOOL        WINAPI SetVolumeLabelA(LPCSTR,LPCSTR);
 WINBASEAPI BOOL        WINAPI SetVolumeLabelW(LPCWSTR,LPCWSTR);
 #define                       SetVolumeLabel WINELIB_NAME_AW(SetVolumeLabel)
@@ -2708,7 +2692,6 @@ WINBASEAPI BOOL        WINAPI SetVolumeMountPointW(LPCWSTR,LPCWSTR);
 WINBASEAPI BOOL        WINAPI SetWaitableTimer(HANDLE,const LARGE_INTEGER*,LONG,PTIMERAPCROUTINE,LPVOID,BOOL);
 WINBASEAPI BOOL        WINAPI SetWaitableTimerEx(HANDLE,const LARGE_INTEGER*,LONG,PTIMERAPCROUTINE,LPVOID,REASON_CONTEXT*,ULONG);
 WINBASEAPI BOOL        WINAPI SetUmsThreadInformation(PUMS_CONTEXT,UMS_THREAD_INFO_CLASS,void *,ULONG);
-WINBASEAPI BOOL        WINAPI SetXStateFeaturesMask(CONTEXT*, DWORD64);
 WINBASEAPI BOOL        WINAPI SetupComm(HANDLE,DWORD,DWORD);
 WINBASEAPI DWORD       WINAPI SignalObjectAndWait(HANDLE,HANDLE,DWORD,BOOL);
 WINBASEAPI DWORD       WINAPI SizeofResource(HMODULE,HRSRC);
diff --git a/mingw-w64-tools/widl/include/winnt.h b/mingw-w64-tools/widl/include/winnt.h
index 9296a3d..2d6837d 100644
--- a/mingw-w64-tools/widl/include/winnt.h
+++ b/mingw-w64-tools/widl/include/winnt.h
@@ -1066,25 +1066,6 @@ typedef struct _I386_CONTEXT
 #define CONTEXT_I386_FULL (CONTEXT_I386_CONTROL | CONTEXT_I386_INTEGER | CONTEXT_I386_SEGMENTS)
 #define CONTEXT_I386_ALL (CONTEXT_I386_FULL | CONTEXT_I386_FLOATING_POINT | CONTEXT_I386_DEBUG_REGISTERS | CONTEXT_I386_EXTENDED_REGISTERS)
 
-#ifdef __i386__
-
-#define CONTEXT_CONTROL CONTEXT_I386_CONTROL
-#define CONTEXT_INTEGER CONTEXT_I386_INTEGER
-#define CONTEXT_SEGMENTS CONTEXT_I386_SEGMENTS
-#define CONTEXT_FLOATING_POINT CONTEXT_I386_FLOATING_POINT
-#define CONTEXT_DEBUG_REGISTERS CONTEXT_I386_DEBUG_REGISTERS
-#define CONTEXT_EXTENDED_REGISTERS CONTEXT_I386_EXTENDED_REGISTERS
-#define CONTEXT_XSTATE CONTEXT_I386_XSTATE
-#define CONTEXT_FULL CONTEXT_I386_FULL
-#define CONTEXT_ALL CONTEXT_I386_ALL
-#define SIZE_OF_80387_REGISTERS I386_SIZE_OF_80387_REGISTERS
-#define MAXIMUM_SUPPORTED_EXTENSION I386_MAXIMUM_SUPPORTED_EXTENSION
-
-typedef I386_FLOATING_SAVE_AREA FLOATING_SAVE_AREA, *PFLOATING_SAVE_AREA;
-typedef I386_CONTEXT CONTEXT, *PCONTEXT;
-
-#endif  /* __i386__ */
-
 typedef struct _LDT_ENTRY {
     WORD	LimitLow;
     WORD	BaseLow;
@@ -1243,73 +1224,6 @@ typedef struct DECLSPEC_ALIGN(16) _AMD64_CONTEXT {
     DWORD64 LastExceptionFromRip; /* 4c8 */
 } AMD64_CONTEXT;
 
-#ifdef __x86_64__
-
-#define CONTEXT_CONTROL CONTEXT_AMD64_CONTROL
-#define CONTEXT_INTEGER CONTEXT_AMD64_INTEGER
-#define CONTEXT_SEGMENTS CONTEXT_AMD64_SEGMENTS
-#define CONTEXT_FLOATING_POINT CONTEXT_AMD64_FLOATING_POINT
-#define CONTEXT_DEBUG_REGISTERS CONTEXT_AMD64_DEBUG_REGISTERS
-#define CONTEXT_XSTATE CONTEXT_AMD64_XSTATE
-#define CONTEXT_FULL CONTEXT_AMD64_FULL
-#define CONTEXT_ALL CONTEXT_AMD64_ALL
-
-typedef AMD64_CONTEXT CONTEXT, *PCONTEXT;
-typedef AMD64_RUNTIME_FUNCTION RUNTIME_FUNCTION, *PRUNTIME_FUNCTION;
-
-typedef struct _KNONVOLATILE_CONTEXT_POINTERS
-{
-    union
-    {
-        PM128A FloatingContext[16];
-        struct
-        {
-            PM128A Xmm0;
-            PM128A Xmm1;
-            PM128A Xmm2;
-            PM128A Xmm3;
-            PM128A Xmm4;
-            PM128A Xmm5;
-            PM128A Xmm6;
-            PM128A Xmm7;
-            PM128A Xmm8;
-            PM128A Xmm9;
-            PM128A Xmm10;
-            PM128A Xmm11;
-            PM128A Xmm12;
-            PM128A Xmm13;
-            PM128A Xmm14;
-            PM128A Xmm15;
-        } DUMMYSTRUCTNAME;
-    } DUMMYUNIONNAME;
-
-    union
-    {
-        PULONG64 IntegerContext[16];
-        struct
-        {
-            PULONG64 Rax;
-            PULONG64 Rcx;
-            PULONG64 Rdx;
-            PULONG64 Rbx;
-            PULONG64 Rsp;
-            PULONG64 Rbp;
-            PULONG64 Rsi;
-            PULONG64 Rdi;
-            PULONG64 R8;
-            PULONG64 R9;
-            PULONG64 R10;
-            PULONG64 R11;
-            PULONG64 R12;
-            PULONG64 R13;
-            PULONG64 R14;
-            PULONG64 R15;
-        } DUMMYSTRUCTNAME;
-    } DUMMYUNIONNAME2;
-} KNONVOLATILE_CONTEXT_POINTERS, *PKNONVOLATILE_CONTEXT_POINTERS;
-
-#endif /* __x86_64__ */
-
 #define XSTATE_LEGACY_FLOATING_POINT 0
 #define XSTATE_LEGACY_SSE            1
 #define XSTATE_GSSE                  2
@@ -1471,42 +1385,6 @@ typedef struct _ARM_CONTEXT
     ULONG Padding2[2];              /* 198 */
 } ARM_CONTEXT;
 
-#ifdef __arm__
-
-#define CONTEXT_CONTROL CONTEXT_ARM_CONTROL
-#define CONTEXT_INTEGER CONTEXT_ARM_INTEGER
-#define CONTEXT_FLOATING_POINT CONTEXT_ARM_FLOATING_POINT
-#define CONTEXT_DEBUG_REGISTERS CONTEXT_ARM_DEBUG_REGISTERS
-#define CONTEXT_FULL CONTEXT_ARM_FULL
-#define CONTEXT_ALL CONTEXT_ARM_ALL
-
-typedef IMAGE_ARM_RUNTIME_FUNCTION_ENTRY RUNTIME_FUNCTION, *PRUNTIME_FUNCTION;
-typedef ARM_NEON128 NEON128, *PNEON128;
-typedef ARM_CONTEXT CONTEXT, *PCONTEXT;
-
-typedef struct _KNONVOLATILE_CONTEXT_POINTERS
-{
-    PDWORD     R4;
-    PDWORD     R5;
-    PDWORD     R6;
-    PDWORD     R7;
-    PDWORD     R8;
-    PDWORD     R9;
-    PDWORD     R10;
-    PDWORD     R11;
-    PDWORD     Lr;
-    PULONGLONG D8;
-    PULONGLONG D9;
-    PULONGLONG D10;
-    PULONGLONG D11;
-    PULONGLONG D12;
-    PULONGLONG D13;
-    PULONGLONG D14;
-    PULONGLONG D15;
-} KNONVOLATILE_CONTEXT_POINTERS, *PKNONVOLATILE_CONTEXT_POINTERS;
-
-#endif /* __arm__ */
-
 #define CONTEXT_ARM64           0x400000
 #define CONTEXT_ARM64_CONTROL         (CONTEXT_ARM64 | 0x00000001)
 #define CONTEXT_ARM64_INTEGER         (CONTEXT_ARM64 | 0x00000002)
@@ -1612,51 +1490,6 @@ typedef struct DECLSPEC_ALIGN(16) _ARM64_NT_CONTEXT
     DWORD64 Wvr[ARM64_MAX_WATCHPOINTS]; /* 380 */
 } ARM64_NT_CONTEXT, *PARM64_NT_CONTEXT;
 
-#ifdef __aarch64__
-
-#define CONTEXT_CONTROL CONTEXT_ARM64_CONTROL
-#define CONTEXT_INTEGER CONTEXT_ARM64_INTEGER
-#define CONTEXT_FLOATING_POINT CONTEXT_ARM64_FLOATING_POINT
-#define CONTEXT_DEBUG_REGISTERS CONTEXT_ARM64_DEBUG_REGISTERS
-#define CONTEXT_FULL CONTEXT_ARM64_FULL
-#define CONTEXT_ALL CONTEXT_ARM64_ALL
-
-typedef IMAGE_ARM64_RUNTIME_FUNCTION_ENTRY RUNTIME_FUNCTION, *PRUNTIME_FUNCTION;
-typedef ARM64_NT_NEON128 NEON128, *PNEON128;
-typedef ARM64_NT_CONTEXT CONTEXT, *PCONTEXT;
-
-typedef struct _KNONVOLATILE_CONTEXT_POINTERS
-{
-    PDWORD64 X19;
-    PDWORD64 X20;
-    PDWORD64 X21;
-    PDWORD64 X22;
-    PDWORD64 X23;
-    PDWORD64 X24;
-    PDWORD64 X25;
-    PDWORD64 X26;
-    PDWORD64 X27;
-    PDWORD64 X28;
-    PDWORD64 Fp;
-    PDWORD64 Lr;
-    PDWORD64 D8;
-    PDWORD64 D9;
-    PDWORD64 D10;
-    PDWORD64 D11;
-    PDWORD64 D12;
-    PDWORD64 D13;
-    PDWORD64 D14;
-    PDWORD64 D15;
-} KNONVOLATILE_CONTEXT_POINTERS, *PKNONVOLATILE_CONTEXT_POINTERS;
-
-#endif /* __aarch64__ */
-
-#if !defined(CONTEXT_FULL) && !defined(RC_INVOKED)
-#error You need to define a CONTEXT for your CPU
-#endif
-
-NTSYSAPI void WINAPI RtlCaptureContext(CONTEXT*);
-
 #define WOW64_CONTEXT_i386 0x00010000
 #define WOW64_CONTEXT_i486 0x00010000
 #define WOW64_CONTEXT_CONTROL (WOW64_CONTEXT_i386 | __MSABI_LONG(0x00000001))
@@ -1688,164 +1521,6 @@ NTSYSAPI void WINAPI RtlCaptureContext(CONTEXT*);
 struct _EXCEPTION_POINTERS;
 struct _EXCEPTION_RECORD;
 
-typedef EXCEPTION_DISPOSITION WINAPI EXCEPTION_ROUTINE(struct _EXCEPTION_RECORD*,PVOID,CONTEXT*,PVOID);
-typedef EXCEPTION_ROUTINE *PEXCEPTION_ROUTINE;
-
-#ifdef __x86_64__
-
-#define UNWIND_HISTORY_TABLE_SIZE 12
-
-typedef struct _UNWIND_HISTORY_TABLE_ENTRY
-{
-    ULONG64 ImageBase;
-    PRUNTIME_FUNCTION FunctionEntry;
-} UNWIND_HISTORY_TABLE_ENTRY, *PUNWIND_HISTORY_TABLE_ENTRY;
-
-#define UNWIND_HISTORY_TABLE_NONE 0
-#define UNWIND_HISTORY_TABLE_GLOBAL 1
-#define UNWIND_HISTORY_TABLE_LOCAL 2
-
-typedef struct _UNWIND_HISTORY_TABLE
-{
-    ULONG Count;
-    UCHAR Search;
-    ULONG64 LowAddress;
-    ULONG64 HighAddress;
-    UNWIND_HISTORY_TABLE_ENTRY Entry[UNWIND_HISTORY_TABLE_SIZE];
-} UNWIND_HISTORY_TABLE, *PUNWIND_HISTORY_TABLE;
-
-typedef struct _DISPATCHER_CONTEXT
-{
-    ULONG64               ControlPc;
-    ULONG64               ImageBase;
-    PRUNTIME_FUNCTION     FunctionEntry;
-    ULONG64               EstablisherFrame;
-    ULONG64               TargetIp;
-    PCONTEXT              ContextRecord;
-    PEXCEPTION_ROUTINE    LanguageHandler;
-    PVOID                 HandlerData;
-    PUNWIND_HISTORY_TABLE HistoryTable;
-    DWORD                 ScopeIndex;
-    DWORD                 Fill0;
-} DISPATCHER_CONTEXT, *PDISPATCHER_CONTEXT;
-
-typedef LONG (CALLBACK *PEXCEPTION_FILTER)(struct _EXCEPTION_POINTERS*,PVOID);
-typedef void (CALLBACK *PTERMINATION_HANDLER)(BOOLEAN,PVOID);
-
-#define UNW_FLAG_NHANDLER  0
-#define UNW_FLAG_EHANDLER  1
-#define UNW_FLAG_UHANDLER  2
-#define UNW_FLAG_CHAININFO 4
-
-#elif defined(__arm__)
-
-#define UNWIND_HISTORY_TABLE_SIZE 12
-
-typedef struct _UNWIND_HISTORY_TABLE_ENTRY
-{
-    DWORD ImageBase;
-    PRUNTIME_FUNCTION FunctionEntry;
-} UNWIND_HISTORY_TABLE_ENTRY, *PUNWIND_HISTORY_TABLE_ENTRY;
-
-typedef struct _UNWIND_HISTORY_TABLE
-{
-    DWORD Count;
-    BYTE  LocalHint;
-    BYTE  GlobalHint;
-    BYTE  Search;
-    BYTE  Once;
-    DWORD LowAddress;
-    DWORD HighAddress;
-    UNWIND_HISTORY_TABLE_ENTRY Entry[UNWIND_HISTORY_TABLE_SIZE];
-} UNWIND_HISTORY_TABLE, *PUNWIND_HISTORY_TABLE;
-
-typedef struct _DISPATCHER_CONTEXT
-{
-    DWORD                 ControlPc;
-    DWORD                 ImageBase;
-    PRUNTIME_FUNCTION     FunctionEntry;
-    DWORD                 EstablisherFrame;
-    DWORD                 TargetPc;
-    PCONTEXT              ContextRecord;
-    PEXCEPTION_ROUTINE    LanguageHandler;
-    PVOID                 HandlerData;
-    PUNWIND_HISTORY_TABLE HistoryTable;
-    DWORD                 ScopeIndex;
-    BOOLEAN               ControlPcIsUnwound;
-    PBYTE                 NonVolatileRegisters;
-    DWORD                 Reserved;
-} DISPATCHER_CONTEXT, *PDISPATCHER_CONTEXT;
-
-typedef LONG (CALLBACK *PEXCEPTION_FILTER)(struct _EXCEPTION_POINTERS*,DWORD);
-typedef void (CALLBACK *PTERMINATION_HANDLER)(BOOLEAN,DWORD);
-
-#define UNW_FLAG_NHANDLER  0
-#define UNW_FLAG_EHANDLER  1
-#define UNW_FLAG_UHANDLER  2
-
-#elif defined(__aarch64__)
-
-#define UNWIND_HISTORY_TABLE_SIZE 12
-
-typedef struct _UNWIND_HISTORY_TABLE_ENTRY
-{
-    DWORD64 ImageBase;
-    PRUNTIME_FUNCTION FunctionEntry;
-} UNWIND_HISTORY_TABLE_ENTRY, *PUNWIND_HISTORY_TABLE_ENTRY;
-
-typedef struct _UNWIND_HISTORY_TABLE
-{
-    DWORD   Count;
-    BYTE    LocalHint;
-    BYTE    GlobalHint;
-    BYTE    Search;
-    BYTE    Once;
-    DWORD64 LowAddress;
-    DWORD64 HighAddress;
-    UNWIND_HISTORY_TABLE_ENTRY Entry[UNWIND_HISTORY_TABLE_SIZE];
-} UNWIND_HISTORY_TABLE, *PUNWIND_HISTORY_TABLE;
-
-typedef struct _DISPATCHER_CONTEXT
-{
-    ULONG_PTR             ControlPc;
-    ULONG_PTR             ImageBase;
-    PRUNTIME_FUNCTION     FunctionEntry;
-    ULONG_PTR             EstablisherFrame;
-    ULONG_PTR             TargetPc;
-    PCONTEXT              ContextRecord;
-    PEXCEPTION_ROUTINE    LanguageHandler;
-    PVOID                 HandlerData;
-    PUNWIND_HISTORY_TABLE HistoryTable;
-    DWORD                 ScopeIndex;
-    BOOLEAN               ControlPcIsUnwound;
-    PBYTE                 NonVolatileRegisters;
-} DISPATCHER_CONTEXT, *PDISPATCHER_CONTEXT;
-
-typedef LONG (CALLBACK *PEXCEPTION_FILTER)(struct _EXCEPTION_POINTERS*,DWORD64);
-typedef void (CALLBACK *PTERMINATION_HANDLER)(BOOLEAN,DWORD64);
-
-#define UNW_FLAG_NHANDLER  0
-#define UNW_FLAG_EHANDLER  1
-#define UNW_FLAG_UHANDLER  2
-
-#endif /* __aarch64__ */
-
-#if defined(__x86_64__) || defined(__arm__) || defined(__aarch64__)
-
-typedef PRUNTIME_FUNCTION (CALLBACK *PGET_RUNTIME_FUNCTION_CALLBACK)(DWORD_PTR,PVOID);
-
-NTSYSAPI BOOLEAN CDECL  RtlAddFunctionTable(RUNTIME_FUNCTION*,DWORD,DWORD_PTR);
-NTSYSAPI DWORD   WINAPI RtlAddGrowableFunctionTable(void**,PRUNTIME_FUNCTION,DWORD,DWORD,ULONG_PTR,ULONG_PTR);
-NTSYSAPI BOOLEAN CDECL  RtlDeleteFunctionTable(RUNTIME_FUNCTION*);
-NTSYSAPI void    WINAPI RtlDeleteGrowableFunctionTable(void*);
-NTSYSAPI void    WINAPI RtlGrowFunctionTable(void*,DWORD);
-NTSYSAPI BOOLEAN CDECL  RtlInstallFunctionTableCallback(DWORD_PTR,DWORD_PTR,DWORD,PGET_RUNTIME_FUNCTION_CALLBACK,PVOID,PCWSTR);
-NTSYSAPI PRUNTIME_FUNCTION WINAPI RtlLookupFunctionEntry(DWORD_PTR,DWORD_PTR*,UNWIND_HISTORY_TABLE*);
-NTSYSAPI void    WINAPI RtlUnwindEx(PVOID,PVOID,struct _EXCEPTION_RECORD*,PVOID,CONTEXT*,UNWIND_HISTORY_TABLE*);
-NTSYSAPI PVOID   WINAPI RtlVirtualUnwind(DWORD,ULONG_PTR,ULONG_PTR,RUNTIME_FUNCTION*,CONTEXT*,PVOID*,ULONG_PTR*,KNONVOLATILE_CONTEXT_POINTERS*);
-
-#endif
-
 /*
  * Product types
  */
@@ -2087,57 +1762,6 @@ typedef struct _EXCEPTION_RECORD64
     DWORD64  ExceptionInformation[EXCEPTION_MAXIMUM_PARAMETERS];
 } EXCEPTION_RECORD64, *PEXCEPTION_RECORD64;
 
-/*
- * The exception pointers structure passed to exception filters
- * in except() and the UnhandledExceptionFilter().
- */
-
-typedef struct _EXCEPTION_POINTERS
-{
-  PEXCEPTION_RECORD  ExceptionRecord;
-  PCONTEXT           ContextRecord;
-} EXCEPTION_POINTERS, *PEXCEPTION_POINTERS;
-
-
-/*
- * The exception frame, used for registering exception handlers
- * Win32 cares only about this, but compilers generally emit
- * larger exception frames for their own use.
- */
-
-struct _EXCEPTION_REGISTRATION_RECORD;
-
-typedef DWORD (CDECL *PEXCEPTION_HANDLER)(PEXCEPTION_RECORD,struct _EXCEPTION_REGISTRATION_RECORD*,
-                                          PCONTEXT,struct _EXCEPTION_REGISTRATION_RECORD **);
-
-typedef struct _EXCEPTION_REGISTRATION_RECORD
-{
-  struct _EXCEPTION_REGISTRATION_RECORD *Prev;
-  PEXCEPTION_HANDLER       Handler;
-} EXCEPTION_REGISTRATION_RECORD;
-
-/*
- * function pointer to an exception filter
- */
-
-typedef LONG (CALLBACK *PVECTORED_EXCEPTION_HANDLER)(PEXCEPTION_POINTERS ExceptionInfo);
-
-typedef struct _NT_TIB
-{
-	struct _EXCEPTION_REGISTRATION_RECORD *ExceptionList;
-	PVOID StackBase;
-	PVOID StackLimit;
-	PVOID SubSystemTib;
-	union {
-          PVOID FiberData;
-          DWORD Version;
-	} DUMMYUNIONNAME;
-	PVOID ArbitraryUserPointer;
-	struct _NT_TIB *Self;
-} NT_TIB, *PNT_TIB;
-
-struct _TEB;
-
 #if defined(__i386__) && defined(__GNUC__) && ((__GNUC__ > 3) || ((__GNUC__ == 3) && (__GNUC_MINOR__ >= 2)))
 static FORCEINLINE struct _TEB * WINAPI NtCurrentTeb(void)
 {
diff --git a/mingw-w64-tools/widl/src/pathtools.c b/mingw-w64-tools/widl/src/pathtools.c
index 29fa335..71613b2 100644
--- a/mingw-w64-tools/widl/src/pathtools.c
+++ b/mingw-w64-tools/widl/src/pathtools.c
@@ -12,9 +12,7 @@
 #include <limits.h>
 #include <stdio.h>
 #include <string.h>
-#if defined(__linux__) || defined(__CYGWIN__) || defined(__MSYS__)
 #include <alloca.h>
-#endif
 #include <unistd.h>
 
 /* If you don't define this, then get_executable_path()
diff --git a/mingw-w64-tools/widl/tools.h b/mingw-w64-tools/widl/tools.h
index 1e86e38..edcb80c 100644
--- a/mingw-w64-tools/widl/tools.h
+++ b/mingw-w64-tools/widl/tools.h
@@ -79,7 +79,7 @@
 
 struct target
 {
-    enum { CPU_i386, CPU_x86_64, CPU_ARM, CPU_ARM64 } cpu;
+    enum { CPU_i386, CPU_x86_64, CPU_ARM, CPU_ARM64, CPU_UNSPECIFIED } cpu;
 
     enum
     {
@@ -384,7 +384,7 @@ static inline struct target get_default_target(void)
 #elif defined(__aarch64__)
     target.cpu = CPU_ARM64;
 #else
-#error Unsupported CPU
+    target.cpu = CPU_UNSPECIFIED;
 #endif
 
 #ifdef __APPLE__
-- 
2.39.1

